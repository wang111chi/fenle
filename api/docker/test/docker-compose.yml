version: '2'
services:
  test:
    build:
      context: ../../..
      dockerfile: api/docker/test/Dockerfile
    volumes:
     - ../../../config_global:/fenle/config_global
     - ../../config:/fenle/api/config
     - ../../logs:/fenle/api/logs
    entrypoint: ../docker/wait-for-mysql.py pytest
    depends_on:
     - mysql
  repl:
    build:
      context: ../../..
      dockerfile: api/docker/test/Dockerfile-repl
    volumes:
     - ../../../config_global:/fenle/config_global
     - ../../config:/fenle/api/config
     - ../../logs:/fenle/api/logs
    entrypoint: ../docker/wait-for-mysql.py python ipython-entrypoint.py
    depends_on:
     - mysql
  mysql:
    build:
      context: ../../..
      dockerfile: docker/Dockerfile-mysql
    environment:
      - MYSQL_ROOT_PASSWORD=123456
      - MYSQL_DATABASE=fenle_fenqi_db
      - MYSQL_ROOT_HOST=%
